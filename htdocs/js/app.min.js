
function get_imported_entries(){$("#main_content_wait_icon").show();$.post("/cgi-bin/mt.cgi",{m:"get_imported_entries"},function(a){if(!check_for_errors(a)){$("#main_content_wait_icon").hide();return}imported_entries_count=$("MoneyTracker_ImportedEntry",a).length;$("#import_entries").html("\n");imported_entries_list=new List("imported_entries","Imported Entries");$("#import_entries").append(imported_entries_list.getHTML());imported_entries_html='\n<form id="import_entries" onsubmit="javascript: return false">\n<table>\n<thead><tr><th scope="col">Date</th><th>Payee</th><th>Amount</th><th>Description</th><th>Fund</th><th><a href="javascript:void(0)" onclick="toggle_checkboxes(\'import\')">Import</a></th><th><a href="javascript:void(0)" onclick="toggle_checkboxes(\'save\')  ">Save  </a></th>';$("MoneyTracker_ImportedEntry",a).each(function(){imported_entries_html+='<tr id="imported_entry_'+$(this).attr("ID")+'" imported_entry_id="'+$(this).attr("ID")+'"><td><input type="text" name="date" size="10" value="'+format_mysql_date($(this).attr("date"))+'"></input></td><td><input type="text" name="entity" size="20" value="'+$(this).attr("entity")+'"></input></td><td><input type="text" name="amount" size="8" value="'+$(this).attr("amount")+'"></input></td><td><input type="text" name="description" size="10" value="'+$(this).attr("description")+'"></input></td><td><select name="fund_id" width="95" style="width: 95px"><option>loading...</option></select></td><td><input type="checkbox" name="import" value="0"></input></td><td><input type="checkbox" name="save"   value="0"></input></td></tr>'});imported_entries_html+='<tr><td colspan="7" style="{text-align: right}"><input type="submit" onclick="submit_imported_entries()" value="Submit"/></td></tr>\n</table>\n</form>';imported_entries_list.setBody(imported_entries_html);if($("MoneyTracker_ImportedEntry",a).length==0){$("#import_entries input[type=submit]").hide()}imported_entries_list.setComment(imported_entries_count);$("#import_entries input[name=date]").datepicker({changeMonth:false,changeYear:false,showOn:"focus",closeAtTop:false,showOtherMonths:true,dateFormat:"yy/mm/dd"});imported_entries_list.open();$("#import_entries").addClass("loaded");if(!$("#fund_manager").hasClass("loaded")){get_budget(function(){fund_options_html=$("#fund_manager").find("tr[fund_id]").map(function(){return'<option value ="'+$(this).attr("fund_id")+'">'+$(this).find("td:first").text()+"</option>"}).get().join("\n");$("#import_entries select").html(fund_options_html)})}$("#main_content_wait_icon").hide()})}function toggle_checkboxes(a){checkit=$("input[name="+a+"][checked=1]").length<$("input[name="+a+"]").length;$("input[name="+a+"]").each(function(){$(this).attr("checked",checkit)})}function submit_imported_entries(){$("#import_entries tr[imported_entry_id]:has(input[name=save][checked=0], input[name=import][checked=1])").find("input, select").attr("disabled",true);rows2import=$("#import_entries tr[imported_entry_id]:has(input[name=import][checked=1])");rows2save=$("#import_entries tr[imported_entry_id]:has(input[name=save][checked=1])");rows2ignore=$("#import_entries tr[imported_entry_id]:has(input[name=save][checked=0]):has(input[name=import][checked=0])");rows2import.each(import_row);rows2ignore.each(ignore_row)}function import_row(){entry_to_import=$(this).attr("imported_entry_id");$.get("/cgi-bin/mt.cgi",{m:"import_entry",fund_id:$(this).find("[@selected]").val(),date:$(this).find("input[name=date]").val(),entity:$(this).find("input[name=entity]").val(),amount:$(this).find("input[name=amount]").val(),description:$(this).find("input[name=description]").val(),imported_entry_id:$(this).attr("imported_entry_id")},function(a){if(!check_for_errors(a)){return}$("tr[imported_entry_id="+$("MoneyTracker_ImportedEntry",a).attr("ID")+"]:has(input[name=save][checked=0])").remove();$("tr[imported_entry_id="+$("MoneyTracker_ImportedEntry",a).attr("ID")+"]:has(input[name=save][checked=1])").find("select,input").attr("disabled",false).find("input[name=import]").attr("checked",0)})}function ignore_row(){$.get("/cgi-bin/mt.cgi",{m:"edit_object","class":"MoneyTracker::ImportedEntry",ID:$(this).attr("imported_entry_id"),status:"ignored"},function(a){if(!check_for_errors(a)){return}$("tr[imported_entry_id="+$("MoneyTracker_ImportedEntry",a).attr("ID")+"]").remove()})};
MT_ERR_NOT_LOGGED_IN=1;MT_ERR_LOGIN_FAILED=2;MT_MONTH_ABBRV=new Array(undefined,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");MT_MONTH_NAMES=new Array(undefined,"January","February","March","April","May","June","July","August","September","October","November","December");WAIT_ICON_URL="/media/icons/wait/white_arrows.gif";WAIT_ICON_IMG='<img class="wait_icon" border="none" src="'+WAIT_ICON_URL+'"></img>';REFRESH_ICON_URL="/media/icons/PNG/Blue/18/refresh.png";function mt_state_info(a){this.looks_logged_in=false}var mt=new mt_state_info;$(document).ready(function(){mt.looks_logged_in=document.cookie.indexOf("mts=")>=0;$("#login_form form").submit(submit_login_form);args=getArgs();d=new Date();if(args.y){mt.year=parseInt(args.y)}else{mt.year=d.getFullYear()}if(args.m){mt.month=parseInt(args.m)}else{mt.month=d.getMonth()+1}mt.day=d.getDate();change_page(0,1);top_of_main_menu=parseInt($("#main_menu").css("top").substring(0,$("#main_menu").css("top").indexOf("px")));bottom_of_main_menu=top_of_main_menu+130;fix_selected_menu_height=function(){$(".selected_menu").each(function(){elHeight=$(this).height();elTop=sTop()+(wHeight()/2)-(elHeight);elTop=Math.max(bottom_of_main_menu,elTop);$(this).css({top:elTop+"px",marginTop:"0"})})};fix_selected_menu_height();$(window).scroll(fix_selected_menu_height);$("#change_month_option a:eq(0)").attr("href","javascript:void(0)").click(function(){if(mt.month!=1){mt.month=mt.month-1}else{mt.month=12;mt.year=mt.year-1}$("#funds").html("");get_funds()});$("#change_month_option a:eq(1)").attr("href","javascript:void(0)").click(function(){if(mt.month!=12){mt.month=mt.month+1}else{mt.month=1;mt.year=mt.year+1}$("#funds").html("");get_funds()})});function change_page(a,b){$(".selected_menu").hide();switch(a){case 0:if(b||!$("#funds").hasClass("loaded")){$("#funds").html("");get_funds()}$(".logged_out").hide();$(".import_page").hide();$(".fund_manager_page").hide();$(".funds_page").show();break;case 1:if(b||!$("#fund_manager").hasClass("loaded")){$("#fund_manager").html("");get_budget()}$(".logged_out").hide();$(".funds_page").hide();$(".import_page").hide();$(".fund_manager_page").show();break;case 2:if(b||!$("#import_entries").hasClass("loaded")){$("#import_entries").html("");get_imported_entries()}$(".logged_out").hide();$(".funds_page").hide();$(".fund_manager_page").hide();$(".import_page").show();break;default:throw_error(new error("Looks like you hit a bug. Unknown page number: "+a))}}function submit_login_form(){$("#login_wait_icon").show();$("#login_form input[type=submit]").hide();$("#login_form input").attr("disabled",true);$.get("/cgi-bin/mt.cgi",{m:"login",user_name:$("#login_form input:eq(0)").val(),password:$("#login_form input:eq(1)").val()},function(a){$("#login_wait_icon").hide();$("#login_form input[type=submit]").show();$("#login_form input").attr("disabled",false);if(!check_for_errors(a)){return}mt.looks_logged_in=true;$(".logged_out").hide();change_page(0,1)});return false}function logout(){$.post("/cgi-bin/mt.cgi",{m:"logout"},function(a){if(!check_for_errors(a)){return}mt.looks_logged_in=false;$(".logged_in").hide();$(".selected").removeClass(".selected");$(".logged_out").show()})}function check_for_errors(a){if($("MoneyTracker_Error",a).length==0){$(".display_on_login").show();return true}if($("MoneyTracker_Error code",a).text()==MT_ERR_NOT_LOGGED_IN&&mt.looks_logged_in){mt.looks_logged_in=false;alert("Sorry, your session has expired. Please log in again.");$(".logged_in").hide();$(".selected").removeClass(".selected");$(".logged_out").show()}else{if($("MoneyTracker_Error code",a).text()==MT_ERR_NOT_LOGGED_IN&&!mt.looks_logged_in){$(".logged_in").hide();$(".selected").removeClass(".selected");$(".logged_out").show()}else{throw_error(new server_error(a))}}return false}function format_js_date(c){var b=c.getFullYear();var e=c.getMonth()+1;var a=c.getDate();if(e<10){e="0"+e}if(a<10){a="0"+a}return b+"/"+e+"/"+a}function format_mysql_date(e){var b=e.slice(0,4);var c=e.slice(5,7);var a=e.slice(8,10);return b+"/"+c+"/"+a}function throw_error(a){alert(a.msg)}function error(c,b,a){this.msg=c;this.error=b;this.code=a}function server_error(a){this.msg=$("MoneyTracker_Error msg",a).text();this.error=$("MoneyTracker_Error error",a).text();this.code=$("MoneyTracker_Error code",a).text()}function fmtDollars(b){var a=roundNumber(b,2)+"";decimal_part=a.substr(a.indexOf("."));if(decimal_part.length==2){return a+"0"}if(decimal_part.length<2){return a+".00"}return a}function roundNumber(b,c){var a=Math.round(b*Math.pow(10,c))/Math.pow(10,c);return a}function sTop(){return window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop}function wHeight(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body.clientHeight}function getArgs(){var b=new Object();var g=location.search.substring(1);var f=g.split("&");for(var c=0;c<f.length;c++){var h=f[c].indexOf("=");if(h==-1){continue}var a=f[c].substring(0,h);var e=f[c].substring(h+1);b[a]=unescape(e)}return b}function grayOut(a,k){var k=k||{};var j=k.zindex||50;var g=k.opacity||70;var f=(g/100);var l=k.bgcolor||"#000000";var h=document.getElementById("darkenScreenObject");if(!h){var e=document.getElementsByTagName("body")[0];var b=document.createElement("div");b.style.position="absolute";b.style.top="0px";b.style.left="0px";b.style.overflow="hidden";b.style.display="none";b.id="darkenScreenObject";e.appendChild(b);h=document.getElementById("darkenScreenObject")}if(a){if(document.body&&(document.body.scrollWidth||document.body.scrollHeight)){var i=document.body.scrollWidth+"px";var c=document.body.scrollHeight+"px"}else{if(document.body.offsetWidth){var i=document.body.offsetWidth+"px";var c=document.body.offsetHeight+"px"}else{var i="100%";var c="100%"}}h.style.opacity=f;h.style.MozOpacity=f;h.style.filter="alpha(opacity="+g+")";h.style.zIndex=j;h.style.backgroundColor=l;h.style.width=i;h.style.height=c;h.style.display="block"}else{h.style.display="none"}};
function get_budget(a){$("#main_content_wait_icon").show();$.post("/cgi-bin/mt.cgi",{m:"load_budget"},function(b){if(!check_for_errors(b)){$("#main_content_wait_icon").hide();if(a){a(false)}return}if($("MoneyTracker_Budget",b).length>0){id=$("MoneyTracker_Budget",b).attr("ID");budget=new List("b"+id,$("MoneyTracker_Budget",b).attr("name"));$("#fund_manager").html("\n").append(budget.getHTML());funds='\n<form id="create_fund_'+id+'">\n<input type="hidden" name="budget_id" value="'+id+'"></input><table>\n<thead><tr><th scope="col">Name</th><th>Allowance</th><th>Rollover</th></thead>';fund_value_total=0;$("MoneyTracker_Fund",b).each(function(){funds+='<tr id="fund_details_'+$(this).attr("ID")+'" fund_id="'+$(this).attr("ID")+'"onClick="fund_clicked(this)"></td><td>'+$(this).attr("name")+"</td><td>"+$(this).attr("value")+"</td><td>"+($(this).attr("rollover")==1?"X":"")+"</td></tr>";fund_value_total+=parseFloat($(this).attr("value"))});funds+='<tr><td><input type="text"     name="name"     onKeyDown="javascript:return create_fund_key_event(event,'+id+')"></input></td><td><input type="text"     name="value"    onKeyDown="javascript:return create_fund_key_event(event,'+id+')"></input></td><td><input type="checkbox" name="rollover" onKeyDown="javascript:return create_fund_key_event(event,'+id+')"></input></td></tr>\n</table>\n</form>';budget.setBody(funds);budget.setComment(fund_value_total);budget.open();if(a){a(true)}$("#fund_manager").addClass("loaded")}$("#main_content_wait_icon").hide()})}function fund_clicked(a){if($(a).is(".deleting")||$(a).is(".editing")){return}$(a).toggleClass("selected");update_selected_funds_menu()}function edit_fund_key_event(b,c){var a=(b.which)?b.which:b.keyCode;if(a=="13"){edit_fund(c);return false}return true}function create_fund_key_event(b,c){var a=(b.which)?b.which:b.keyCode;if(a=="13"){create_fund(c);return false}return true}function create_fund(a){if($("#create_fund_"+a+' input[name="name"]').attr("disabled")){return}$("#create_fund_"+a+" input").attr("disabled",true);_LISTS["b"+a].setComment('<img class="wait_icon" border="none" src="'+WAIT_ICON_URL+'"></img>');$.get("/cgi-bin/mt.cgi",{m:"create_object","class":"MoneyTracker::Fund",name:$("#create_fund_"+a+' input[name="name"]').val(),value:$("#create_fund_"+a+' input[name="value"]').val(),rollover:$("#create_fund_"+a+' input[name="rollover"]').attr("checked")},function(b){if(!check_for_errors(b)){$("#create_fund_"+a+" input").attr("disabled",false);return}get_budget()})}function show_fund_edit_forms(){$("tr.selected").unbind("click").removeClass("selected").addClass("editing").each(function(){fund_id=$(this).attr("fund_id");fund_name=$("#fund_details_"+fund_id+" td:eq(0)").html();fund_value=$("#fund_details_"+fund_id+" td:eq(1)").html();fund_rollover=$("#fund_details_"+fund_id+" td:eq(2)").attr("checked")?"true":"false";$(this).html('<td><input type="text"     id="fund_details_'+fund_id+'_name"     value="'+fund_name+'"></input></td><td><input type="text"     id="fund_details_'+fund_id+'_value"    value="'+fund_value+'"></input></td><td><input type="checkbox" id="fund_details_'+fund_id+'_rollover" checked="'+fund_rollover+'"></input></td>');$(this).find("input").attr("onKeyDown","javascript:return edit_fund_key_event(event,"+fund_id+")")});update_selected_funds_menu()}function edit_fund(a){if($("#fund_details_"+a).parents("form").find('input[id^="fund_details_'+a+'_name"]').attr("disabled")){return}$("#fund_details_"+a).parents("form").find('input[id^="fund_details_'+a+'_"]').attr("disabled",true);$.get("/cgi-bin/mt.cgi",{m:"edit_object","class":"MoneyTracker::Fund",ID:a,budget_id:$("#fund_details_"+a).parents("form").find('input[name="budget_id"]').val(),name:$("#fund_details_"+a+"_name").val(),value:$("#fund_details_"+a+"_value").val(),rollover:$("#fund_details_"+a+"_rollover").attr("checked")?"1":"0"},function(b){if(!check_for_errors(b)){$("#entry_"+a).parents("form").find('input[id^="fund_details_'+a+'_"]').attr("disabled",false);return}if($("MoneyTracker_Fund",b).length==1){fund_id=$("MoneyTracker_Fund",b).attr("ID");fund_name=$("MoneyTracker_Fund",b).attr("name");fund_value=$("MoneyTracker_Fund",b).attr("value");fund_rollover=$("MoneyTracker_Fund",b).attr("rollover");$("#fund_details_"+fund_id).html("<td>"+fund_name+"</td><td>"+fund_value+"</td><td>"+(fund_rollover==1?"X":"")+"</td>");$("#fund_details_"+fund_id).removeClass("editing").removeClass("selected");update_selected_funds_menu()}else{$("#entry_"+a).parents("form").find('input[id^="fund_details_'+a+'_"]').attr("disabled",false);throw_error(new error("I didn't understand the response from the server. This could be a bug."))}})}function delete_funds(){$("#fund_manager").find("tr.selected").unbind("click").removeClass("selected").addClass("deleting").each(function(){$.get("/cgi-bin/mt.cgi",{m:"delete_object","class":"MoneyTracker::Fund",ID:$(this).attr("fund_id")},function(a){if(!check_for_errors(a)){$("#fund_manager").find("tr.selected").removeClass("deleting").addClass("selected");return}fund_id_deleted=$("MoneyTracker_Fund",a).attr("ID");$("#fund_details_"+fund_id_deleted).remove();update_selected_funds_menu()})})}function deselect_funds(){$("#fund_manager").find(".selected").removeClass("selected");update_selected_funds_menu()}function update_selected_funds_menu(){menu=$("#selected_funds_menu");selected=$("#fund_manager").find(".selected").length;editing=$("#fund_manager").find(".editing").length;deleting=$("#fund_manager").find(".deleting").length;total=selected+editing+deleting;sum=0;count=0;$("#fund_manager").find(".selected").each(function(){sum+=parseFloat($(this).find("td:eq(1)").text());count++});$("#selected_funds_sum").text(roundNumber(sum,2));$("#selected_funds_count").text(count);if(selected==0){menu.hide()}else{menu.show()}};
function Lists(){}_LISTS=new Lists();function getList(a){return _LISTS[a]}function List(d,a,c,b){this.id=d;this.name=a;this.comment=c;this.load=b==undefined?function(){}:b;this.header_id="#list_header_"+this.id;this.body_id="#list_body_"+this.id;_LISTS[d]=this;this.getHTML=function(){list='\n<div  id="list_header_'+this.id+'" class="list_header" onclick="_LISTS[\''+this.id+"'].clicked()\" onMouseOver=\"_LISTS['"+this.id+"'].mOver()\" onMouseOut =\"_LISTS['"+this.id+'\'].mOut() " >\n<span id="list_name_'+this.id+'" class="list_name"   >'+this.name+'</span><span id="list_comment_'+this.id+'" class="list_comment">'+this.comment+'</span>\n</div>\n<div class="list_body" style="display:none" id="list_body_'+this.id+'"></div>\n';return list};this.clicked=function(){if($(this.body_id).css("display")=="none"&&$(this.body_id).html()==""){this.load(this.id,true)}else{if($(this.body_id).css("display")=="none"){this.open()}else{this.close()}}};this.open=function(){$(this.header_id).addClass("open");$(this.body_id).show()};this.close=function(){$(this.body_id).hide();$(this.header_id).removeClass("open")};this.mOver=function(){if(!$(this.header_id).is(".open")){$(this.header_id).removeClass("list_header").addClass("list_header_hover")}};this.mOut=function(){if(!$(this.header_id).is(".open")){$(this.header_id).removeClass("list_header_hover").addClass("list_header")}};this.getComment=function(){return $("#list_comment_"+this.id)};this.setComment=function(e){this.comment=e;$("#list_comment_"+this.id).html(this.comment)};this.setBody=function(e){$("#list_body_"+this.id).html(e)};this.getBody=function(){return $("#list_body_"+this.id)}};
function FundList(f,a,e,b,c){this.inheritFrom=List;this.inheritFrom("f"+f,a,e+'&nbsp;/&nbsp;<span class="fund_allowance">'+b+"</span>",c);this.allowance=b;this.balance=e;this.fund_id=f;this.appendTo=function(g){html=this.getHTML();$(g).append(html);$("#list_body_"+this.id).html('<div id="fund_list_details_'+this.fund_id+'" class="list_details" >Allowance: '+this.allowance+'</div>\n<form id="create_entry_'+this.fund_id+'">\n<input type="hidden" name="fund_id" value="'+this.fund_id+'"></input><table>\n<thead><tr><th scope="col">Date</th><th>Payee</th><th>Amount</th><th>Description</th></thead>\n<tbody><tr><td><input type="text" name="date"        size="10" onKeyDown="javascript:return create_entry_key_event(event,'+this.fund_id+')"></input></td><td><input type="text" name="entity"      size="20" onKeyDown="javascript:return create_entry_key_event(event,'+this.fund_id+')"></input></td><td><input type="text" name="amount"      size="10" onKeyDown="javascript:return create_entry_key_event(event,'+this.fund_id+')"></input></td><td><input type="text" name="description" size="25" onKeyDown="javascript:return create_entry_key_event(event,'+this.fund_id+')"></input></td></tr></tbody>\n</table>\n</form>\n');this.setBalance(this.balance);$("#create_entry_"+f+" input[name=date]").datepicker({changeMonth:false,changeYear:false,showOn:"focus",closeAtTop:false,showOtherMonths:true,dateFormat:"yy/mm/dd",defaultDate:new Date(mt.year,mt.month-1,mt.day)});$("#create_entry_"+f+" input[name=entity]").autocomplete("/cgi-bin/mt.cgi",{cacheLength:3,extraParams:{m:"ac_entity",fund:f},autoFill:1});return this};this.setRows=function(g){$("#list_body_"+this.id+" tbody > tr:last").before(g);return this};this.getRows=function(){return $("#list_body_"+this.id+" tbody")};this.setBalance=function(g){this.balance=parseFloat(g);this.setComment(fmtDollars(this.balance)+'&nbsp;/&nbsp;<span class="fund_allowance">'+this.allowance+"</span>");rounded=roundNumber(this.balance,2);if(rounded<0){this.getComment().removeClass("zero_balance").addClass("negative_balance")}else{if(rounded==0){this.getComment().removeClass("negative_balance").addClass("zero_balance")}else{this.getComment().removeClass("negative_balance").removeClass("zero_balance")}}return this};this.getBalance=function(){return parseFloat(this.balance)};this.updateBalance=function(){e=parseFloat(this.allowance);this.getBody().find("tr[entry_id] td:nth-child(3)").each(function(){amount=$(this).text();e+=parseFloat(amount)});this.setBalance(e);return this}}function getFundList(a){return getList("f"+a)}function get_funds(){$("#main_content_wait_icon").show();$.post("/cgi-bin/mt.cgi",{m:"get_entries",month:mt.month,year:mt.year},function(a){if(!check_for_errors(a)){$("#main_content_wait_icon").hide();return}process_funds_xml(a);$("#main_content_wait_icon").hide()})}function process_funds_xml(a){if($("MoneyTracker_Fund",a).length>0){$("#funds").html("\n");d=new Date();if(mt.year==d.getFullYear()){$("#month_display").html(MT_MONTH_NAMES[mt.month])}else{$("#month_display").html(MT_MONTH_ABBRV[mt.month]+" "+mt.year)}$("MoneyTracker_Fund",a).each(function(){id=$(this).attr("ID");fund=new FundList(id,$(this).attr("name"),$(this).attr("balance"),$(this).attr("value"),reload_fund);fund.appendTo("#funds");process_fund_xml($("MoneyTracker_Fund[ID="+id+"]",a))});$("#funds").addClass("loaded")}}function reload_fund(b,a){$.get("/cgi-bin/mt.cgi",{m:"get_entries",month:mt.month,year:mt.year,fund_id:b},function(c){if(!check_for_errors(c)){return}process_fund_xml(c);if(a){getFundList(b).show()}})}function process_fund_xml(a){id=a.attr?a.attr("ID"):$("MoneyTracker_Fund",a).attr("ID");fund_list=getFundList(id);entries="";$("MoneyTracker_Entry",a).each(function(){entries+='<tr id="entry_'+$(this).attr("ID")+'" entry_id="'+$(this).attr("ID")+'" onClick="entry_clicked(this)"><td>'+format_mysql_date($(this).attr("date"))+"</td><td>"+$(this).attr("entity")+"</td><td>"+$(this).attr("amount")+"</td><td>"+$(this).attr("description")+"</td></tr>"});fund_list.setRows(entries)}function entry_clicked(a){if($(a).is(".deleting")||$(a).is(".editing")){return}$(a).toggleClass("selected");update_selected_menu()}function edit_entry_key_event(c,b){var a=(c.which)?c.which:c.keyCode;if(a=="13"){edit_entry(b);return false}return true}function create_entry_key_event(b,c){var a=(b.which)?b.which:b.keyCode;if(a=="13"){create_entry(c);return false}return true}function create_entry(a){if($("#create_entry_"+a+' input[name="date"]').attr("disabled")){return}if(!validate_entry("#create_entry_"+a)){return}$("#create_entry_"+a+" input").attr("disabled",true);getFundList(a).setComment(WAIT_ICON_IMG);$.get("/cgi-bin/mt.cgi",{m:"create_object","class":"MoneyTracker::Entry",fund_id:$("#create_entry_"+a+' input[name="fund_id"]').val(),date:$("#create_entry_"+a+' input[name="date"]').val(),entity:$("#create_entry_"+a+' input[name="entity"]').val(),amount:$("#create_entry_"+a+' input[name="amount"]').val(),description:$("#create_entry_"+a+' input[name="description"]').val()},function(b){if(!check_for_errors(b)){$("#create_entry_"+a+" input").attr("disabled",false);return}insert_new_entry(b);$("#create_entry_"+a+" input").attr("disabled",false).not("[type=hidden]").val("")})}function validate_entry(a){if($(a+' input[name="date"]').val()==""){alert("Please specify a date.");return false}return true}function insert_new_entry(a){entry=a.attr?a:$("MoneyTracker_Entry",a);entry_date=format_mysql_date(entry.attr("date"));entry_html='<tr id="entry_'+entry.attr("ID")+'" entry_id="'+entry.attr("ID")+'"onClick="entry_clicked(this)"><td>'+entry_date+"</td><td>"+entry.attr("entity")+"</td><td>"+entry.attr("amount")+"</td><td>"+entry.attr("description")+"</td></tr>";fund_list=getFundList(entry.attr("fund_id"));entries=fund_list.getBody().find("tr[entry_id]");inserted=false;for(i=0;i<entries.length;i++){this_entry=entries.eq(i);this_date=this_entry.find("td:first").text();if(!inserted&&this_date>entry_date){this_entry.before(entry_html);inserted=true}}if(!inserted){fund_list.getBody().find("tr:last").before(entry_html)}fund_list.setBalance(fund_list.getBalance()+parseFloat(entry.attr("amount")))}function show_edit_forms(){$("tr.selected").unbind("click").removeClass("selected").addClass("editing").each(function(){entry_id=$(this).attr("entry_id");entry_date=$("#entry_"+entry_id+" td:eq(0)").html();entry_entity=$("#entry_"+entry_id+" td:eq(1)").html();entry_amount=$("#entry_"+entry_id+" td:eq(2)").html();entry_desc=$("#entry_"+entry_id+" td:eq(3)").html();$(this).html('<td><input type="text" id="entry_'+entry_id+'_date"        size="10" value="'+entry_date+'"></input></td><td><input type="text" id="entry_'+entry_id+'_entity"      size="20" value="'+entry_entity+'"></input></td><td><input type="text" id="entry_'+entry_id+'_amount"      size="10" value="'+entry_amount+'"></input></td><td><input type="text" id="entry_'+entry_id+'_description" size="25" value="'+entry_desc+'"></input></td>');$(this).find("input").attr("onKeyDown","javascript:return edit_entry_key_event(event,"+entry_id+")");$("#entry_"+entry_id+"_date").datepicker({changeMonth:false,changeYear:false,showOn:"focus",closeAtTop:false,showOtherMonths:true,dateFormat:"yy/mm/dd"})});update_selected_menu()}function edit_entry(a){if($("#entry_"+a).parents("form").find('input[id^="entry_'+a+'_date"]').attr("disabled")){return}$("#entry_"+a).parents("form").find('input[id^="entry_'+a+'_"]').attr("disabled",true);$.get("/cgi-bin/mt.cgi",{m:"edit_object","class":"MoneyTracker::Entry",ID:a,fund_id:$("#entry_"+a).parents("form").find('input[name="fund_id"]').val(),date:$("#entry_"+a+"_date").val(),entity:$("#entry_"+a+"_entity").val(),amount:$("#entry_"+a+"_amount").val(),description:$("#entry_"+a+"_description").val()},function(b){if(!check_for_errors(b)){$("#entry_"+a).parents("form").find('input[id^="entry_'+a+'_"]').attr("disabled",false);return}if($("MoneyTracker_Entry",b).length==1){entry_id=$("MoneyTracker_Entry",b).attr("ID");fund_id=$("MoneyTracker_Entry",b).attr("fund_id");entry_date=$("MoneyTracker_Entry",b).attr("date");entry_entity=$("MoneyTracker_Entry",b).attr("entity");entry_amount=$("MoneyTracker_Entry",b).attr("amount");entry_desc=$("MoneyTracker_Entry",b).attr("description");$("#entry_"+entry_id).html("<td>"+format_mysql_date(entry_date)+"</td><td>"+entry_entity+"</td><td>"+entry_amount+"</td><td>"+entry_desc+"</td>");getFundList(fund_id).updateBalance();$("#entry_"+entry_id).removeClass("editing").removeClass("selected");update_selected_menu()}else{$("#entry_"+a).parents("form").find('input[id^="entry_'+a+'_"]').attr("disabled",false);throw_error(new error("I didn't understand the response from the server. This could be a bug."))}})}function delete_entries(){$("tr.selected").unbind("click").removeClass("selected").addClass("deleting").each(function(){$.get("/cgi-bin/mt.cgi",{m:"delete_object","class":"MoneyTracker::Entry",ID:$(this).attr("entry_id")},function(a){if(!check_for_errors(a)){$("tr.selected").removeClass("deleting").addClass("selected");return}entry=$("MoneyTracker_Entry",a);entry_id=entry.attr("ID");fund_id=entry.attr("fund_id");amount=entry.attr("amount");getFundList(fund_id).setBalance(fund_list.getBalance()-parseFloat(amount));$("#entry_"+entry_id).remove();update_selected_menu()})})}function deselect_entries(){$(".selected").removeClass("selected");update_selected_menu()}function update_selected_menu(){menu=$("#selected_menu");selected=$(".selected").length;editing=$(".editing").length;deleting=$(".deleting").length;total=selected+editing+deleting;sum=0;count=0;$(".selected").each(function(){sum+=parseFloat($(this).find("td:eq(2)").text());count++});$("#selected_sum").text(fmtDollars(sum));$("#selected_count").text(count);if(selected==0){menu.hide()}else{menu.show()}};